var __extends=this&&this.__extends||function(d,e){function b(){this.constructor=d}for(var a in e)e.hasOwnProperty(a)&&(d[a]=e[a]);d.prototype=null===e?Object.create(e):(b.prototype=e.prototype,new b)},Annotations;
(function(d){var e=CCL.CommonFunctions,b=CCL.CommonWindowMessages,a=function(){function c(c){this.settings=c;this.pdfjs=window.PDFJS;this.manager=new d.Manager(c)}c.prototype.init=function(){var c=this;e.makePostMessageCall(window.parent,new b.GenericMessageWithData(b.MessageNames.extensionContentOpened,{iframeHeight:-1}));e.makePostMessageCall(window.parent,new b.GenericMessageWithData(b.MessageNames.iframeAutoHeight,{enabled:!0}));if(this.settings.Onboarding){var a=this.settings.Onboarding.AddNoteDialogClientId;
(new d.OnboardingTour).init(a,this.settings.OnboardingCssClasses)}$("#toolbarClose").on("click",function(){e.makePostMessageCall(window.parent,new b.GenericMessageWithData(b.MessageNames.iframeAutoHeight,{enabled:!1}));history.go(-1)});$(function(){c.pdfjs.webViewerLoad(c.settings.Urls.FileUrl,function(){var a=window.PDFViewerApplication;if(c.settings.Urls.FileUrl){a.eventBus.on("textlayerrendered",function(b){c.manager.renderLayer(b,a.pdfViewer.currentScale)});var b=function(b){c.manager.scaleChanged(a.pdfViewer.currentScale)};
a.eventBus.on("scalechanged",b);a.eventBus.on("zoomin",b);a.eventBus.on("zoomout",b)}else c.settings.Terms.ErrorMessage?a.error(c.settings.Terms.ErrorMessage):a.error(c.settings.Terms.ErrorOccured)},c.settings.PdfJsWorker,c.settings.PdfJsCmapsFolder,c.settings.FileName)})};return c}();d.AnnotationApp=a})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(){}b.prototype.init=function(a,c){(new Assignment.Onboarding.Step(c,a,CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentAddNote)).start()};return b}();d.OnboardingTour=e})(Annotations||(Annotations={}));(function(d){var e=function(){return function(){}}();d.AnnotationAttributesModel=e})(Annotations||(Annotations={}));
(function(d){var e=function(){return function(b){var a=this;this.setArrow=function(c){a.clearArrowCss();switch(c){case d.TetheredBoxPosition.sides.top:a.$boxElement.addClass(a.arrowCssClasses.bottom);break;case d.TetheredBoxPosition.sides.left:a.$boxElement.addClass(a.arrowCssClasses.right);break;case d.TetheredBoxPosition.sides.bottom:a.$boxElement.addClass(a.arrowCssClasses.top);break;case d.TetheredBoxPosition.sides.right:a.$boxElement.addClass(a.arrowCssClasses.left)}};this.clearArrowCss=function(){a.$boxElement.removeClass(a.arrowCssClasses.top+
" "+a.arrowCssClasses.right+" "+a.arrowCssClasses.bottom+" "+a.arrowCssClasses.left)};this.box=new d.TetheredBox({$element:b.$boxElement});this.$boxElement=b.$boxElement;this.arrowCssClasses=b.arrowCssClasses}}();d.Box=e})(Annotations||(Annotations={}));(function(d){var e=function(){return function(){}}();d.ArrowCssClassesModel=e})(Annotations||(Annotations={}));(function(d){var e=function(){return function(){}}();d.BoxSettingsModel=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(){this.cache={}}b.prototype.addPageItem=function(a,c){var g=this.pageKey(a);this.cache.hasOwnProperty(g)||(this.cache[g]=[]);this.cache[g].push(c)};b.prototype.getByPage=function(a){a=this.pageKey(a);if(this.cache.hasOwnProperty(a)){a=this.cache[a];var c=[],g;for(g in a)a.hasOwnProperty(g)&&c.push(a[g]);return c}return null};b.prototype["delete"]=function(a,c){this.cache[this.pageKey(a)].splice(c,1)};b.prototype.update=function(a,c,g){this.cache[this.pageKey(a)][c]=
g};b.prototype.pageKey=function(a){return"page_"+a};return b}();d.MemoryDataStorage=e})(Annotations||(Annotations={}));(function(d){var e=function(){return function(){}}();d.Annotation=e})(Annotations||(Annotations={}));(function(d){var e=function(b){function a(){b.apply(this,arguments);this.LastPromise=null;this.Id=new d.AnnotationCacheId}__extends(a,b);return a}(d.Annotation);d.AnnotationCache=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){this.value=a}b.prototype.valueOf=function(){return this.value};return b}();d.LocalAnnotationIdType=e;e=function(){function b(a){this.value=a}b.prototype.valueOf=function(){return this.value};return b}();d.RemoteAnnotationIdType=e;e=function(){return function(){}}();d.AnnotationCacheId=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(){}b.adjustRectangles=function(a){return $.map(a,function(c){return{x:c.left?c.left:c.x,y:c.top?c.top:c.y,width:c.width,height:c.height}})};b.adjustToViewport=function(a,c){return $.map(a,function(a){return{x:(a.x-c.offsetX)*c.scale,y:(a.y-c.offsetY)*c.scale,width:a.width*c.scale,height:a.height*c.scale}})};b.adjustToDefaultScale=function(a,c){return $.map(a,function(a){return{x:(a.x-c.offsetX)/c.scale,y:(a.y-c.offsetY)/c.scale,width:a.width/c.scale,height:a.height/
c.scale}})};b.getRectanglesBounds=function(a){for(var c={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity},g=0;g<a.length;g++){var b=a[g];c.top>b.top&&(c.top=b.top);c.right<b.right&&(c.right=b.right);c.bottom<b.bottom&&(c.bottom=b.bottom);c.left>b.left&&(c.left=b.left)}return c};return b}();d.RectanglesTransformation=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){this.searchById=function(c,a,b){for(var k=0;k<c.length;k++)if(b(c[k],a))return[c[k],k];return[new d.AnnotationCache,-1]};this.filterByLocalId=function(c,a){return c.Id.LocalId&&c.Id.LocalId.valueOf()===a.valueOf()};this.filterByRemoteId=function(c,a){return c.Id.RemoteId&&c.Id.RemoteId.valueOf()===a.valueOf()};this.cache=a}b.prototype.add=function(a,c,g){var b=c instanceof d.LocalAnnotationIdType,k=new d.AnnotationCache;$.extend(k,g);b?k.Id.LocalId=c:k.Id.RemoteId=
c;this.cache.addPageItem(a,k)};b.prototype.get=function(a,c){var g=c instanceof d.LocalAnnotationIdType,b=this.cache.getByPage(a);return this.searchById(b,c,g?this.filterByLocalId:this.filterByRemoteId)[0]};b.prototype.getIndex=function(a,c){var g=c instanceof d.LocalAnnotationIdType,b=this.cache.getByPage(a);return this.searchById(b,c,g?this.filterByLocalId:this.filterByRemoteId)[1]};b.prototype.getByPage=function(a){return this.cache.getByPage(a)};b.prototype["delete"]=function(a,c){var g=this.getIndex(a,
c);this.cache["delete"](a,g)};b.prototype.updateAnnotation=function(a,c,g,b){void 0===b&&(b=!0);var k=this.getIndex(a,c);c=this.get(a,c);b||(g.Text=c.Text);g.LastPromise=c.LastPromise;g.Id=c.Id;g.Id.RemoteId=new d.RemoteAnnotationIdType(parseInt(g.AnnotationId));this.cache.update(a,k,g)};return b}();d.MemoryDataStorageProvider=e})(Annotations||(Annotations={}));
(function(d){var e=function(b){function a(c){var a=this;b.call(this,c.boxSettings);this.isEditMode=!1;this.disableSaveButtonIfTextEmpty=function(){a.getTextAreaVal().trim()?a.saveButton.toggleHyperlink(!0):a.saveButton.toggleHyperlink(!1)};this.boxReposition=function(){var c=a.$boxElement.height();if(c!==a.boxHeight){var b=parseFloat(a.$boxElement.css("top")),e=void 0;switch(a.side){case d.TetheredBoxPosition.sides.left:case d.TetheredBoxPosition.sides.right:e=(c-a.boxHeight)/2;break;case d.TetheredBoxPosition.sides.top:e=
c-a.boxHeight;break;default:e=0}a.$boxElement.css("top",b-e);a.boxHeight=c}};this.onDelete=function(){a.isEditMode=!1;a.deleteHandler();a.hide(0)};this.onUpdate=function(){a.saveButton.getIfHyperLinkEnabled()&&(a.isEditMode=!1,a.updateHandler(a.getTextAreaVal()),a.setText(a.getTextAreaVal()),a.toggleForEditing(),a.boxReposition())};this.show=function(c,b,d,e){a.isEditMode||(a.boxHeight=a.$boxElement.height(),a.side=a.box.showByRects(c,b,d),a.setArrow(a.side),a.saveButton.is(":visible")&&a.toggleForEditing())};
this.hide=function(c){void 0===c&&(c=0);a.isEditMode||(0===c?a.box.hide():a.$boxElement.delay(c).hide(0))};this.forceHide=function(){a.isEditMode=!1;a.box.hide()};this.toggleForEditing=function(){a.$boxElement.find("."+a.cssClasses.AnnotationTooltipSaveButton+", ."+a.cssClasses.AnnotationTooltipEditButton).toggle();a.$boxElement.find("."+a.cssClasses.AnnotationTooltipDeleteButton+", ."+a.cssClasses.AnnotationTooltipCancelButton).toggle();a.$boxElement.find("."+a.cssClasses.AnnotationTooltipText+", ."+
a.cssClasses.AnnotationTooltipTextareaContainer).toggle()};this.hideForReadOnly=function(){a.$boxElement.find("."+a.cssClasses.AnnotationTooltipSaveButton+", ."+a.cssClasses.AnnotationTooltipEditButton+", "+("."+a.cssClasses.AnnotationTooltipDeleteButton+", ."+a.cssClasses.AnnotationTooltipCancelButton)).hide()};this.cssClasses=c.cssClasses;this.genericUserIcon=c.genericUserIcon;this.deleteHandler=c.onDelete;this.updateHandler=c.onUpdate;this.readOnlyMode=c.readOnlyMode;this.saveButton=this.$boxElement.find("."+
this.cssClasses.AnnotationTooltipSaveButton);this.textArea=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipTextarea);this.readOnlyMode&&this.hideForReadOnly();this.initEvents()}__extends(a,b);a.prototype.initEvents=function(){var c=this;this.readOnlyMode||(this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipDeleteButton,this.onDelete),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipCancelButton,function(){c.isEditMode=!1;c.toggleForEditing();c.boxReposition()}),
this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipEditButton,function(){c.$boxElement.find("."+c.cssClasses.AnnotationTooltipEditButton).getIfHyperLinkEnabled()&&(c.isEditMode=!0,c.textAreaHeight=parseFloat(c.$boxElement.find("."+c.cssClasses.AnnotationTooltipText).css("height")),c.textArea.css("height",c.textAreaHeight),c.toggleForEditing(),c.textArea.focus(),c.setTextAreaVal(c.getText()),c.disableSaveButtonIfTextEmpty(),c.boxReposition())}),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipSaveButton,
this.onUpdate),this.$boxElement.on("input","."+this.cssClasses.AnnotationTooltipTextarea,this.disableSaveButtonIfTextEmpty))};a.prototype.getText=function(){return this.$boxElement.find("."+this.cssClasses.AnnotationTooltipText).text()};a.prototype.setText=function(c){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipText).text(c)};a.prototype.getTextAreaVal=function(){return this.textArea.val()};a.prototype.setTextAreaVal=function(c){this.textArea.val("");this.textArea.val(c)};a.prototype.setIcon=
function(c){c?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",c):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",this.genericUserIcon)};a.prototype.setTitle=function(c){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonName).text(c)};a.prototype.disableEditButton=function(c){c?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipEditButton).toggleHyperlink(!0):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipEditButton).toggleHyperlink(!1)};
return a}(d.Box);d.TooltipBox=e})(Annotations||(Annotations={}));
(function(d){var e=function(b){function a(c){var a=this;b.call(this,c.boxSettings);this.disablePostButtonIfTextEmpty=function(){a.textArea.val().trim()?a.postButton.toggleHyperlink(!0):a.postButton.toggleHyperlink(!1)};this.onPost=function(c){if(a.postButton.getIfHyperLinkEnabled()){var b=a.textArea.val();a.postHandler({text:b},c);a.textArea.val("")}};this.show=function(c,b){var d=a.box.show(c,b);a.textArea.val("");a.textArea.focus();a.postButton.toggleHyperlink(!1);a.setArrow(d)};this.cssClasses=
c.cssClasses;this.genericUserIcon=c.genericUserIcon;this.postHandler=c.onPost;this.cancelHandler=c.onCancel;this.postButton=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPostButton);this.textArea=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipTextarea);c.iconUrl?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",c.iconUrl):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",this.genericUserIcon);
this.initEvents()}__extends(a,b);a.prototype.initEvents=function(){var c=this;this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipPostButton,this.onPost);this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipCancelButton,function(){c.cancelHandler();c.box.hide()});this.$boxElement.on("input","."+this.cssClasses.AnnotationTooltipTextarea,this.disablePostButtonIfTextEmpty)};return a}(d.Box);d.AddAnnotationBox=e})(Annotations||(Annotations={}));
(function(d){var e=function(b){function a(c){var a=this;b.call(this,c.boxSettings);this.show=function(c,b){var d=a.box.show(c,b);a.setArrow(d)};this.$boxElement.click(c.click)}__extends(a,b);return a}(d.Box);d.BubbleBox=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a,c,b){this.$pageDiv=$(a);this.attributes=c;this.cssClasses=b;this.$textLayerDiv=$(this.$pageDiv.find(".textLayer"));this.number=parseInt(this.$pageDiv.attr("data-page-number"))}b.prototype.getPageDiv=function(){return this.$pageDiv};b.prototype.getTextLayerTransformScale=function(){return this.$textLayerDiv.height()/this.$pageDiv.height()};b.prototype.getDefaultScaleRectangles=function(a,c){var b={scale:c,offsetX:this.$textLayerDiv.offset().left,offsetY:this.$textLayerDiv.offset().top};
a=d.RectanglesTransformation.adjustRectangles(a);return d.RectanglesTransformation.adjustToDefaultScale(a,b)};b.prototype.getActualScaleRectangles=function(a,c){var b={scale:c,offsetX:0,offsetY:0};a=d.RectanglesTransformation.adjustRectangles(a);return d.RectanglesTransformation.adjustToViewport(a,b)};b.prototype.renderAnnotation=function(a,c,b,f){void 0===f&&(f=!1);b={scale:b*this.getTextLayerTransformScale(),offsetX:0,offsetY:0};c=d.RectanglesTransformation.adjustRectangles(c);c=d.RectanglesTransformation.adjustToViewport(c,
b);a=d.ShapeBuilder.createHighlight(c,this.cssClasses.AnnotationHighlight).attr(this.attributes.AnnotationId,a.AnnotationId).attr(this.attributes.AnnotationType,a.Type).attr(this.attributes.AnnotationComment,a.Text).addClass(this.cssClasses.AnnotationContainer+" "+this.cssClasses.TooltipAble);f&&a.attr(this.attributes.AnnotationIsLocal,"true");this.$textLayerDiv.append(a)};b.prototype.renderSelection=function(a,c){var b={scale:c*this.getTextLayerTransformScale(),offsetX:0,offsetY:0};a=d.RectanglesTransformation.adjustRectangles(a);
a=d.RectanglesTransformation.adjustToViewport(a,b);b=d.ShapeBuilder.createHighlight(a,this.cssClasses.Selection).addClass(this.cssClasses.SelectionContainer);this.$textLayerDiv.prepend(b)};b.prototype.removeAnnotation=function(a){this.$textLayerDiv.find("."+this.cssClasses.AnnotationContainer+"["+this.attributes.AnnotationId+"="+a+"]").remove()};b.prototype.removeSelection=function(){this.getPageDiv().find("."+this.cssClasses.SelectionContainer).remove()};b.prototype.updateAnnotationId=function(a,
c){this.getPageDiv().find("["+this.attributes.AnnotationId+"="+a+"]").attr(this.attributes.AnnotationId,c).removeAttr(this.attributes.AnnotationIsLocal)};return b}();d.Page=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){var c=this;this.attrubutes={AnnotationId:"data-pdf-annotate-id",AnnotationIsLocal:"data-pdf-annotate-local",AnnotationComment:"data-pdf-annotate-comment",AnnotationType:"data-pdf-annotate-type"};this.monitorScroll=function(){c.selection&&c.tooltip.hide()};this.scaleChanged=function(a){c.scale=a;c.bubble&&c.bubble.box.hide();c.addAnnotation&&c.addAnnotation.box.hide();c.tooltip&&c.tooltip.box.hide()};this.showAnnotationBox=function(a){c.selection.eraseNative();
c.bubble.box.hide();c.addAnnotation.show(c.selection.getBoundary(),c.$viewer)};this.addAnnotationCancel=function(){c.selection.getPage().removeSelection()};this.createAnnotation=function(a,b){var g=c.selection.getPage(),f=g.getDefaultScaleRectangles(c.selection.getClientRects(),c.scale),e={FileId:c.settings.FileRepoId,Annotation:{Text:"text",Page:g.number},Shape:{Structure:JSON.stringify(f)},Comment:{Text:a.text}},n=c.uuid(),p={Type:1,Text:a.text,AnnotationId:n,Page:g.number,Structure:JSON.stringify(f),
ProfileImageSmallUrl:c.settings.Urls.UserProfileImage,FullName:c.settings.UserFullName,HasEditPermission:!0};c.storage.add(g.number,new d.LocalAnnotationIdType(n),e,p).done(function(a){g.updateAnnotationId(n,a.AnnotationId);c.tooltip.annotation&&c.tooltip.annotation.AnnotationId===n&&(c.tooltip.annotation.AnnotationId=a.AnnotationId,c.tooltip.setText(a.Text),c.tooltip.isLocal=!1)}).fail(function(a){a.status===CCL.CommonConstants.httpStatusCodes.badRequest&&g.removeAnnotation(n)});g.renderAnnotation(p,
f,c.scale,!0);g.removeSelection();c.addAnnotation.box.hide()};this.removeAnnotation=function(){var a=c.tooltip.isLocal?new d.LocalAnnotationIdType(c.tooltip.annotation.AnnotationId):new d.RemoteAnnotationIdType(c.tooltip.annotation.AnnotationId);c.storage["delete"](c.tooltip.annotation.Page,a);c.tooltip.page.removeAnnotation(c.tooltip.annotation.AnnotationId)};this.updateAnnotation=function(a){var b=c.tooltip.isLocal?new d.LocalAnnotationIdType(c.tooltip.annotation.AnnotationId):new d.RemoteAnnotationIdType(c.tooltip.annotation.AnnotationId);
c.storage.update(c.tooltip.annotation.Page,b,a).done(function(a){c.tooltip.annotation&&c.tooltip.annotation.AnnotationId===a.AnnotationId&&c.tooltip.setText(a.Text)})};this.triggerBubble=function(a){c.selection&&c.selection.getPage().removeSelection();c.selection=new d.TextSelection({pageDiv:$(a.target).closest(".page"),attributes:c.attrubutes,cssClasses:c.settings.CssClasses});if(c.selection.isEmpty())c.bubble.box.hide();else{a=c.selection.getPage();var b=c.selection.getClientRects(),b=a.getDefaultScaleRectangles(b,
c.scale);a.renderSelection(b,c.scale);c.selection.saveDefaultScaleSelection(b);c.bubble.show(c.selection.getBoundary(),c.$viewer)}c.addAnnotation.box.hide();CCL.CommonFunctions.isMobileDevice()||c.tooltip.forceHide()};this.triggerTooltip=function(a,b){if(!c.tooltip.isEditMode){var g=$(a.currentTarget).attr(c.attrubutes.AnnotationId),f=$(a.currentTarget).attr(c.attrubutes.AnnotationIsLocal)?!0:!1,g=f?new d.LocalAnnotationIdType(g):new d.RemoteAnnotationIdType(parseInt(g));c.storage.getAnnotationByPage(b.number,
g).then(function(a){c.tooltip.annotation=a;c.tooltip.isLocal=f;c.tooltip.page=b;c.tooltip.setText(a.Text);c.tooltip.setTitle(a.FullName);c.tooltip.setIcon(a.ProfileImageSmallUrl);c.tooltip.disableEditButton(a.HasEditPermission);c.tooltip.show(b.getActualScaleRectangles(JSON.parse(a.Structure),c.scale),b.getPageDiv(),c.$viewer,a.AnnotationId)})}};this.settings=a;this.shapeBuilder=new d.ShapeBuilder;var b={top:a.CssClasses.BubbleArrowTop,right:a.CssClasses.BubbleArrowRight,bottom:a.CssClasses.BubbleArrowBottom,
left:a.CssClasses.BubbleArrowLeft},f={top:a.CssClasses.TooltipArrowTop,right:a.CssClasses.TooltipArrowRight,bottom:a.CssClasses.TooltipArrowBottom,left:a.CssClasses.TooltipArrowLeft};a.IsReadOnly||(this.bubble=new d.BubbleBox({boxSettings:{$boxElement:$("#bubbleBox"),arrowCssClasses:b},click:this.showAnnotationBox}),this.addAnnotation=new d.AddAnnotationBox({boxSettings:{$boxElement:$("#addAnnotationBox"),arrowCssClasses:f},onPost:this.createAnnotation,onCancel:this.addAnnotationCancel,iconUrl:a.Urls.UserProfileImage,
cssClasses:a.CssClasses,genericUserIcon:a.Urls.DefaultPersonAvatar}));this.tooltip=new d.TooltipBox({boxSettings:{$boxElement:$("#tooltipBox"),arrowCssClasses:f},onDelete:this.removeAnnotation,onUpdate:this.updateAnnotation,readOnlyMode:a.IsReadOnly,cssClasses:a.CssClasses,genericUserIcon:a.Urls.DefaultPersonAvatar});$("#viewerContainer").on("scroll",this.monitorScroll);this.storage=new d.ServerStorage(a)}b.prototype.renderLayer=function(a,c){var b=this;this.$viewer=$("#viewer");this.scale=c;if(a.source.textLayerDiv.offsetParent){var f=
new d.Page(a.source.textLayerDiv.offsetParent,this.attrubutes,this.settings.CssClasses);if(!this.settings.IsReadOnly)if(CCL.CommonFunctions.isMobileDevice())$(a.source.textLayerDiv).on("touchstart",this.triggerBubble);else $(a.source.textLayerDiv).mouseup(this.triggerBubble),$(a.source.textLayerDiv).mousedown(function(){b.selection&&b.selection.eraseNative()});$(a.source.textLayerDiv).on("click touchstart",function(a){$(a.target).parent().hasClass(b.settings.CssClasses.TooltipAble)||b.tooltip.forceHide()});
this.storage.getByPage(f.number).then(function(a){for(var b=0;b<a.length;b++){var g=a[b];f.renderAnnotation(g,JSON.parse(g.Structure),c)}});$(a.source.textLayerDiv).on("click touchstart","."+this.settings.CssClasses.TooltipAble,function(a){return b.triggerTooltip(a,f)})}};b.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,this.replacement)};b.prototype.replacement=function(a){var c=16*Math.random()|0;return("x"===a?c:c&3|8).toString(16)};return b}();d.Manager=
e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){var c=this;this.defaultContentType="application/json;charset=utf-8";this.failResponseHandler=function(a){a.status===CCL.CommonConstants.httpStatusCodes.internalServerError&&alert(c.settings.Terms.ErrorOccured)};this.settings=a;this.endpoint=a.Urls.Endpoint;a=new d.MemoryDataStorage;this.cacheProvider=new d.MemoryDataStorageProvider(a)}b.prototype.update=function(a,c,b){var d=this,e=this.cacheProvider.get(a,c).Text;this.cacheProvider.get(a,c).Text=b;var h=
function(){var e=d.cacheProvider.get(a,c);return $.ajax({type:"PUT",url:d.endpoint,data:JSON.stringify({AnnotationId:e.AnnotationId,AnnotationCommentId:e.AnnotationCommentId,Text:b}),contentType:d.defaultContentType})},l=this.cacheProvider.get(a,c).LastPromise,m;l?(m=l.pipe(h),this.cacheProvider.get(a,c).LastPromise=m):m=$.when(h());m.done(function(e){if(b!==e.Text){var k=d.cacheProvider.get(a,c).LastPromise;if(null===k||k===m)d.cacheProvider.get(a,c).Text=e.Text}}).fail(function(b){b.status===CCL.CommonConstants.httpStatusCodes.badRequest&&
(d.cacheProvider.get(a,c).Text=e);d.failResponseHandler(b)});return m};b.prototype["delete"]=function(a,c){var b=this,d=function(){var d=b.cacheProvider.get(a,c);return $.ajax({type:"DELETE",url:b.endpoint+"&annotationId="+d.AnnotationId,contentType:b.defaultContentType}).done(function(){b.cacheProvider["delete"](a,c)}).fail(b.failResponseHandler)},e=this.cacheProvider.get(a,c).LastPromise;e?e.pipe(d):d()};b.prototype.add=function(a,c,b,d){var e=this,h=$.ajax({type:"POST",url:this.endpoint,data:JSON.stringify(b),
contentType:this.defaultContentType});d.LastPromise=h;this.cacheProvider.add(a,c,d);h.done(function(b){var d=e.cacheProvider.get(a,c).LastPromise===h;e.cacheProvider.updateAnnotation(a,c,b,d)}).fail(function(b){b.status===CCL.CommonConstants.httpStatusCodes.badRequest&&e.cacheProvider["delete"](a,c);e.failResponseHandler(b)});return h};b.prototype.getByPage=function(a){var c=this.cacheProvider.getByPage(a);return null===c?this.load([a]):$.Deferred().resolve(c)};b.prototype.getAnnotationByPage=function(a,
c){var b=this.cacheProvider.get(a,c);return null===b?this.load([a]):$.Deferred().resolve(b)};b.prototype.load=function(a){var c=this;if(a)a=a.map(function(a,c){return"pages="+a}).reduce(function(a,c,b){return a+"&"+c},"");else throw Error("pages or page should be specified");return $.get(this.endpoint+a).done(function(a,b,e){for(b=0;b<a.length;b++)c.cacheProvider.add(a[b].Page,new d.RemoteAnnotationIdType(a[b].AnnotationId),a[b])}).fail(this.failResponseHandler)};return b}();d.ServerStorage=e})(Annotations||
(Annotations={}));(function(d){var e=function(){function b(){}b.createHighlight=function(a,c){var b=this,d=$("<div>");$.each(a,function(a,e){var l=b.rectangleToDiv(e).addClass(c);d.append(l)});return d};b.rectangleToDiv=function(a){return $("<div>").css({left:a.x,top:a.y,width:a.width,height:a.height})};return b}();d.ShapeBuilder=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){this.$window=$(window);this.pageBorderSize=9;this.options=a;this.init()}b.prototype.init=function(){this.resetBoundary();this.boundaryStorage=[];this.$element=this.$mainContainer=this.options.$element};b.prototype.resetBoundary=function(){this.boundary={id:0,bounds:{left:0,top:0,right:0,bottom:0}}};b.prototype.show=function(a,c){this.$page=c;var b={out:{width:this.$window.width(),height:this.$window.height()},box:{width:this.$mainContainer.width(),height:this.$mainContainer.height()},
bounds:a},b=(new d.TetheredBoxPosition(b)).getTargetPosition();this.$mainContainer.css({left:b.left-c.offset().left,top:b.top-c.offset().top}).show();this.isVisible=!0;return b.side};b.prototype.showByRects=function(a,c,b){this.$page=c;a=this.addOffset(d.RectanglesTransformation.getRectanglesBounds(this.transformRectangles(a)));a={out:{width:this.$window.width(),height:this.$window.height()},box:{width:this.$mainContainer.width(),height:this.$mainContainer.height()},bounds:a};a=(new d.TetheredBoxPosition(a)).getTargetPosition();
this.$mainContainer.css({left:a.left-b.offset().left+this.pageBorderSize,top:a.top-b.offset().top+this.pageBorderSize}).show();this.isVisible=!0;return a.side};b.prototype.hide=function(){this.$mainContainer.hide();this.isVisible=!1};b.prototype.transformRectangles=function(a){return $.map(a,function(a){return{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height}})};b.prototype.addOffset=function(a){return{left:a.left+this.$page.offset().left,top:a.top+this.$page.offset().top,right:a.right+this.$page.offset().left,
bottom:a.bottom+this.$page.offset().top}};b.prototype.removeOffset=function(a){return{left:a.left-this.$page.offset().left,top:a.top-this.$page.offset().top,right:a.right-this.$page.offset().left,bottom:a.bottom-this.$page.offset().top}};return b}();d.TetheredBox=e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){this.options=a;this.init()}b.prototype.init=function(){this.out=this.options.out;this.box=this.options.box;this.bounds=this.createBoundsObject(this.options.bounds);this.boundsCenter=this.getBoundsCenter(this.bounds)};b.prototype.getBounds=function(){return this.bounds};b.prototype.getTargetPosition=function(){var a=this.getTargetSide(),c;switch(a){case b.sides.left:c=this.calculateLeftTargetPosition();break;case b.sides.top:c=this.calculateTopTargetPosition();
break;case b.sides.right:c=this.calculateRightTargetPosition();break;case b.sides.bottom:c=this.calculateBottomTargetPosition();break;default:c=this.calculateInsideTargetPosition()}return{left:c.left,top:c.top,right:c.right,bottom:c.bottom,side:a}};b.prototype.createBoundsObject=function(a){return{left:a.left,top:a.top,right:a.right,bottom:a.bottom,distanceToOut:{left:a.left,top:a.top,right:this.out.width-a.right,bottom:this.out.height-a.bottom}}};b.prototype.getBoundsCenter=function(a){var c=a.left+
(a.right-a.left)/2;a=a.top+(a.bottom-a.top)/2;return{x:c,y:a,distanceToOut:{left:c,top:a,right:this.out.width-c,bottom:this.out.height-a}}};b.prototype.getTargetSide=function(){var a=b.sides.inside,c=0,d=this.calculateLeftFreeSpace(),f=this.calculateTopFreeSpace(),e=this.calculateRightFreeSpace(),h=this.calculateBottomFreeSpace();d>c&&(a=b.sides.left,c=d);f>c&&(a=b.sides.top,c=f);e>c&&(a=b.sides.right,c=e);h>c&&(a=b.sides.bottom);return a};b.prototype.calculateLeftFreeSpace=function(){return this.bounds.distanceToOut.left>=
this.box.width&&this.boundsCenter.distanceToOut.top>=this.box.height/2&&this.boundsCenter.distanceToOut.bottom>=this.box.height/2?this.bounds.distanceToOut.left-this.box.width:-1};b.prototype.calculateTopFreeSpace=function(){return this.bounds.distanceToOut.top>=this.box.height&&this.boundsCenter.distanceToOut.left>=this.box.width/2&&this.boundsCenter.distanceToOut.right>=this.box.width/2?this.bounds.distanceToOut.top-this.box.height:-1};b.prototype.calculateRightFreeSpace=function(){return this.bounds.distanceToOut.right>=
this.box.width&&this.boundsCenter.distanceToOut.top>=this.box.height/2&&this.boundsCenter.distanceToOut.bottom>=this.box.height/2?this.bounds.distanceToOut.right-this.box.width:-1};b.prototype.calculateBottomFreeSpace=function(){return this.bounds.distanceToOut.bottom>=this.box.height&&this.boundsCenter.distanceToOut.left>=this.box.width/2&&this.boundsCenter.distanceToOut.right>=this.box.width/2?this.bounds.distanceToOut.bottom-this.box.height:-1};b.prototype.calculateLeftTargetPosition=function(){var a=
this.bounds.left-this.box.width,c=this.boundsCenter.y-this.box.height/2;return{left:a,top:c,right:a+this.box.width,bottom:c+this.box.height}};b.prototype.calculateTopTargetPosition=function(){var a=this.boundsCenter.x-this.box.width/2,c=this.bounds.top-this.box.height;return{left:a,top:c,right:a+this.box.width,bottom:c+this.box.height}};b.prototype.calculateRightTargetPosition=function(){var a=this.bounds.right,c=this.boundsCenter.y-this.box.height/2;return{left:a,top:c,right:a+this.box.width,bottom:c+
this.box.height}};b.prototype.calculateBottomTargetPosition=function(){var a=this.boundsCenter.x-this.box.width/2,c=this.bounds.bottom;return{left:a,top:c,right:a+this.box.width,bottom:c+this.box.height}};b.prototype.calculateInsideTargetPosition=function(){var a=this.out.width/2-this.box.width/2,c=this.out.height/2-this.box.height/2;return{left:a,top:c,right:a+this.box.width,bottom:c+this.box.height}};b.sides={top:"top",right:"right",bottom:"bottom",left:"left",inside:"inside"};return b}();d.TetheredBoxPosition=
e})(Annotations||(Annotations={}));
(function(d){var e=function(){function b(a){this.selection=window.getSelection();this.$pageDiv=$(a.pageDiv);this.attributes=a.attributes;this.cssClasses=a.cssClasses;this.offsetTop=this.$pageDiv.offset().top;this.offsetLeft=this.$pageDiv.offset().left;this.freeze()}b.prototype.getPage=function(){return new d.Page(this.$pageDiv,this.attributes,this.cssClasses)};b.prototype.getRectangles=function(){var a=this.selection.getRangeAt(0);return this.isBrowserIE()?this.clientRectsIEHack(a):a.getClientRects()};
b.prototype.getBoundingRect=function(){var a=this.selection.getRangeAt(0);return this.isBrowserIE()?(a=this.getRectangles(),d.RectanglesTransformation.getRectanglesBounds(a)):a.getBoundingClientRect()};b.prototype.getRange=function(){return this.selection.getRangeAt(0)};b.prototype.eraseNative=function(){window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())};b.prototype.isEmpty=function(){return this.isBrowserIE()&&
0===this.selection.rangeCount?!0:0>=this.getRange().toString().length};b.prototype.freeze=function(){this.isBrowserIE()&&0===this.selection.rangeCount||(this.clientRects=this.getRectangles(),this.boundary=this.getBoundingRect())};b.prototype.saveDefaultScaleSelection=function(a){this.defaultScaleRectangles=a};b.prototype.getBoundary=function(){return this.recalculateRectPositionAfterScroll(this.boundary)};b.prototype.getClientRects=function(){var a=this;return $.map(this.clientRects,function(c){return a.recalculateRectPositionAfterScroll(c)})};
b.prototype.recalculateRectPositionAfterScroll=function(a){var c=this.$pageDiv.offset().top-this.offsetTop,b=this.$pageDiv.offset().left-this.offsetLeft;return{left:a.left+b,top:a.top+c,right:a.right+b,bottom:a.bottom+c,width:a.width,height:a.height}};b.prototype.isBrowserIE=function(){var a=window.navigator.userAgent;return 0<a.indexOf("Trident/")||0<a.indexOf("Edge/")};b.prototype.clientRectsIEHack=function(a){var c;"canvasWrapper"===a.startContainer.className&&a.setStart(a.startContainer.nextSibling.children[0].childNodes[0],
0);if(a.startContainer===a.commonAncestorContainer)return a.getClientRects();var b=[],d=a.cloneRange();d.setEnd(a.startContainer,a.startContainer.length);Array.prototype.push.apply(b,d.getClientRects());for(c=a.startContainer.parentNode.nextSibling;c!==a.endContainer.parentNode&&c&&!$(c).hasClass("endOfContent");)Array.prototype.push.apply(b,c.getClientRects()),c=c.nextSibling;d.setStart(a.endContainer,0);d.setEnd(a.endContainer,a.endOffset);Array.prototype.push.apply(b,d.getClientRects());return b};
return b}();d.TextSelection=e})(Annotations||(Annotations={}));var Assignment;
(function(d){var e=function(){function b(){$(document).on("click","a[data-personid]",function(a){a=$(a.target);a=a.is("a")?a:a.parent("a");a=parseInt(a.data("personid"));0<a&&CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.openPersonProfileCard,a))})}b.prototype.scrollPageToTop=function(){scroll(0,0)};return b}();d.Base=e})(Assignment||(Assignment={}));
(function(d){var e=function(){return function(b){this.navigateAwayMessage=b}}();d.BaseEditSettings=e;e=function(b){function a(a){b.call(this);$("form").areYouSure({message:a.navigateAwayMessage,fieldEvents:"change",dirtyClass:"as-dirty"})}__extends(a,b);return a}(d.Base);d.BaseEdit=e})(Assignment||(Assignment={}));
(function(d){var e=function(b){function a(a,g){var f=this;b.call(this,new d.BaseEditSettings(a.data.navigateAwayMessage));this.bindEvent=function(){f.isAnswerOnBehalfOfTheStudent?(f.$answerOnBehalfOfTheStudentSaveButton.click(f.onSubmitAnswerClick),f.$answerOnBehalfOfTheStudentCancelButton.click(!0,f.onCancelClick.bind(f))):(f.$buttonSave.click(f.onSubmitAnswerClick),f.$buttonSaveDraft.click(!0,f.onSubmitAnswerClick),f.$buttonCancel.click(!0,f.onCancelClick.bind(f)))};this.bindEventForOldUploader=
function(){f.isAnswerOnBehalfOfTheStudent?(f.$answerOnBehalfOfTheStudentSaveButton.click(f.onSubmitClick.bind(f)),f.$answerOnBehalfOfTheStudentCancelButton.click(!0,f.onCancelClick.bind(f))):(f.$buttonSave.click(f.onSubmitClick.bind(f)),f.$buttonSaveDraft.click(!0,f.onSubmitClick.bind(f)),f.$buttonCancel.click(!0,f.onCancelClick.bind(f)))};this.onSubmitAnswerClick=function(a){f.handleError(!1);var c=GetTextEditorContent(f.settings.controls.editorClientInstanceId),b=f.getPressedButton(a.data);0!==
c.length||f.fileUploader.hasFiles()||f.fileUploader.hasLinks()?(f.$feedbackForEmptyAnswer.hide(),$.ajax({url:"api/lo/"+f.settings.data.assignmentId+"/answer/",type:"POST",data:JSON.stringify({assignmentInstanceId:f.settings.data.assignmentInstanceId,assignmentId:f.settings.data.assignmentId,text:c,isDraft:a.data?!0:!1,filesAdded:f.fileUploader.filesAdded,filesRemoved:f.fileUploader.filesRemoved,onBehalfOfUserId:f.settings.data.onBehalfOfUserId,linksAdded:f.fileUploader.linksAdded,linksRemoved:f.fileUploader.linksRemoved,
isEditMode:f.settings.data.isEditMode}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(f.onAnswerSaveDone).fail(f.onAnswerSaveFail,function(){b.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)})):(f.$feedbackForEmptyAnswer.show(),f.scrollPageToTop(),b.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator))};this.onAnswerSaveDone=function(a){CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged));
if(!f.settings.data.isEditMode&&f.isAnswerOnBehalfOfTheStudent){a=f.isNewUploader?parseInt(a):parseInt(a.d);var c=f.settings.urls.assessAnswer+"&"+f.settings.data.answerIdParamName+"="+a;document.location.href=0<a?c:f.settings.urls.returnUrl}else document.location.href=f.settings.urls.returnUrl};this.onAnswerSaveFail=function(a){a=JSON.parse(a.responseText);f.handleError(!0,a)};this.settings=a;this.fileUploader=g;this.isAnswerOnBehalfOfTheStudent=this.settings.data.isAnswerOnBehalfOfTheStudent;CCL.CommonFunctions.makePostMessageCall(window.parent,
new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.hideSettings));this.$feedbackForError=$(this.settings.controls.feedbackForError);this.$feedbackForEmptyAnswer=$(this.settings.controls.feedbackForEmptyAnswer);this.$buttonSave=$(this.settings.controls.buttonSave);this.$buttonSaveDraft=$(this.settings.controls.buttonSaveDraft);this.$buttonCancel=$(this.settings.controls.buttonCancel);this.$answerOnBehalfOfTheStudentSaveButton=$(this.settings.controls.answerOnBehalfOfTheStudentSaveButton);
this.$answerOnBehalfOfTheStudentCancelButton=$(this.settings.controls.answerOnBehalfOfTheStudentCancelButton);(this.isNewUploader=a.data.isNewUploader)?this.bindEvent():this.bindEventForOldUploader();new CCL.ButtonLoadingIndicator(this.$buttonSave,this.settings.data.inProgressClass,[this.$buttonSaveDraft],0);new CCL.ButtonLoadingIndicator(this.$buttonSaveDraft,this.settings.data.inProgressClass,[this.$buttonSave],0);new CCL.ButtonLoadingIndicator(this.$answerOnBehalfOfTheStudentSaveButton,this.settings.data.inProgressClass,
null,0);CCL.IframeContentHeightReporter.addSelectorToListenHeight("#"+this.settings.controls.fileDialogContainer)}__extends(a,b);a.prototype.handleError=function(a,b){b&&(this.$feedbackForError.find(".ccl-feedback-text").text(b.ErrorMessage),this.scrollPageToTop());this.$feedbackForError.toggle(a);this.$buttonSave.toggleHyperlink(!a);this.$buttonSaveDraft.toggleHyperlink(!a)};a.prototype.onSubmitClick=function(a){this.handleError(!1);var b=GetTextEditorContent(this.settings.controls.editorClientInstanceId),
d=FileRepoUploaderInstance.ReadFileList(),e=this.getPressedButton(a.data);if(0===b.length&&0===d.length)this.$feedbackForEmptyAnswer.show(),this.scrollPageToTop(),e.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator);else{this.$feedbackForEmptyAnswer.hide();var h=FileRepoUploaderInstance.GetRemovedFileIds(),l=FileRepoUploaderInstance.GetChangedFilesDictionary();$.ajax({url:this.settings.urls.saveAnswer,type:"POST",data:JSON.stringify({assignmentInstanceId:this.settings.data.assignmentInstanceId,
assignmentId:this.settings.data.assignmentId,text:b,isDraft:a.data?!0:!1,existingFiles:d,changedFiles:l,removedFileIds:h,isExistingAnswer:this.settings.data.isEditMode,onBehalfOfUserId:this.settings.data.onBehalfOfUserId}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(this.onAnswerSaveDone).fail(this.onAnswerSaveFail,function(){e.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)})}};a.prototype.getPressedButton=function(a){return this.isAnswerOnBehalfOfTheStudent?
this.$answerOnBehalfOfTheStudentSaveButton:a?this.$buttonSaveDraft:this.$buttonSave};a.prototype.onCancelClick=function(a){a.preventDefault();CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged));document.location.href=this.settings.urls.returnUrl};return a}(d.BaseEdit);d.Answer=e})(Assignment||(Assignment={}));
(function(d){var e=function(b){function a(a){b.call(this,new d.BaseEditSettings(a.data.navigateAwayMessage));this.settings=a;new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.inProgressClass);$(this.settings.controls.okButtonSelector).click(this.handler.bind(this));$(this.settings.controls.manageRubricLinkSelector).click(this.showManageRubricHandler.bind(this))}__extends(a,b);a.prototype.showManageRubricHandler=function(){CCL.CommonFunctions.makePostMessageCall(window.parent,
{messageName:CCL.CommonWindowMessages.MessageNames.assignmentShowManageRubric})};a.prototype.handler=function(){!1===window.Page_IsValid&&$(this.settings.controls.okButtonSelector).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)};return a}(d.BaseEdit);d.AddEdit=e})(Assignment||(Assignment={}));
(function(d){var e=function(b){function a(a){var g=this;b.call(this,new d.BaseEditSettings(a.data.terms.navigateAwayMessage));CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.hideSettings));this.settings=a;this.$saveAndAssessButton=$(this.settings.controls.saveAndAssessNextButtonSelector);this.$submitButton=$(this.settings.controls.okButtonSelector);this.commentModule=$("#"+this.settings.controls.commentModule).getCommentModuleObject();
this.teacherNoteModule=$("#"+this.settings.controls.teacherNoteModule).getCommentModuleObject();this.commentsAndTeacherNotesContainer=$("#"+this.settings.controls.commentsAndTeacherNotesContainer);this.$commentsContainer=$('[data-contentid="#'+this.settings.controls.commentsContainer+'"]');this.$teacherNotesContainer=$('[data-contentid="#'+this.settings.controls.teacherNotesContainer+'"]');this.$commentTabs=$("#"+this.settings.controls.commentTabs);this.$filesSection=$("#"+this.settings.controls.filesSection);
new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.cssClasses.inProgressClass,[this.settings.controls.saveAndAssessNextButtonSelector]);new CCL.ButtonLoadingIndicator(this.settings.controls.saveAndAssessNextButtonSelector,this.settings.data.cssClasses.inProgressClass,[this.settings.controls.okButtonSelector]);this.$submitButton.click(this.handler.bind(this));this.$saveAndAssessButton.click(this.handler.bind(this));this.settings.controls.annotateFilesOnboardingDialog&&
(new d.Onboarding.Step(this.settings.data.onboardingCssClasses,this.settings.controls.annotateFilesOnboardingDialog,CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentAnnotateAnswerFiles)).start();0<this.$commentTabs.length?(this.$commentTabs.on(CCL.ControlTabsEvent.TabIndexChanged,function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];c=c[0].selectedTab;c===g.settings.data.commentsTabIndex?g.loadCommentModule(g.commentModule):c===g.settings.data.teacherNotesTabIndex&&g.loadCommentModule(g.teacherNoteModule);
g.changeCommentModuleNoPrintClass()}),this.loadCommentModule(this.commentModule)):this.commentModule?(this.loadCommentModule(this.commentModule),this.changeCommentModuleNoPrintClass()):this.teacherNoteModule&&(this.loadCommentModule(this.teacherNoteModule),this.changeCommentModuleNoPrintClass());$(this.commentModule).add(this.teacherNoteModule).on(this.settings.data.commentModuleChangeEvent,function(){return g.changeCommentModuleNoPrintClass()});$("#"+this.settings.controls.requestPlagiarismReportLink).on("click",
function(){g.setUsePlagiarism(!0)});$("#"+this.settings.controls.requestPlagiarismReportCancelLink).on("click",function(){g.setUsePlagiarism(!1)});$(document).on(a.data.kpi.calculateEvent,$.proxy(function(){CCL.CommonFunctions.measureKpi(a.urls.measureKpi,a.data.kpi.measureSection,a.data.kpi.measurement)},this))}__extends(a,b);a.prototype.handler=function(){!1===window.Page_IsValid&&(this.$submitButton.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator),this.$saveAndAssessButton.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator))};
a.prototype.loadCommentModule=function(a){a&&!a.isDataSourceFetchedAtLeastOnce()&&a.loadAndShow();this.currentCommentModule=a};a.prototype.changeCommentModuleNoPrintClass=function(){var a=this.currentCommentModule;this.commentsAndTeacherNotesContainer.add(this.$commentsContainer).add(this.$teacherNotesContainer).removeClass(this.settings.data.cssClasses.noPrint);0<a.getCommentsCountWithoutDeleted()?a===this.commentModule?this.$teacherNotesContainer.addClass(this.settings.data.cssClasses.noPrint):
a===this.teacherNoteModule&&this.$commentsContainer.addClass(this.settings.data.cssClasses.noPrint):this.commentsAndTeacherNotesContainer.addClass(this.settings.data.cssClasses.noPrint)};a.prototype.togglePlagiarismMessage=function(){$("#"+this.settings.controls.requestPlagiarismReport).add("#"+this.settings.controls.requestPlagiarismReportCancel).toggle()};a.prototype.setUsePlagiarism=function(a){var b=this;$.ajax({url:this.settings.urls.setUsePlagiarism,type:"POST",dataType:"json",data:{assignmentId:this.settings.data.assignmentId,
assignmentInstanceId:this.settings.data.assignmentInstanceId,answerId:this.settings.data.answerId,usePlagiarism:a}}).done(function(){b.togglePlagiarismMessage()})};return a}(d.BaseEdit);d.AssessAnswer=e})(Assignment||(Assignment={}));
(function(d){(function(d){var b=function(){function a(a,b){var d=this;window[a]=this;this.settings=b;this.$completedToggle=$("#"+b.Controls.CompletedToggle);this.$scoreText=$("#"+b.Controls.Score);this.$assessment=$("#"+b.Controls.Assessment);this.$loAssessmentState=$("#"+b.Controls.LoAssessmentState);this.$rubricCriterias=$("#"+b.Controls.RubricCriterias);this.rubricToggleChangeValue=b.RubricToggleChangeValue;this.$simplifiedAssessmentStatusList=$("#"+b.Controls.SimplifiedAssessmentStatusList);var e=
$("#"+b.Controls.AssessmentOrScoreFeedback),h=$("#"+b.Controls.CompletedToggleLabel),l=$("#"+b.Controls.AssessmentLabel+", #"+b.Controls.ScoreLabel);this.$scoreText.add(this.$assessment).change(function(){e.hide()});b.IsAssessmentMandatoryForCompletedStatus&&this.$scoreText.add(this.$assessment).add(this.$simplifiedAssessmentStatusList).change(function(){l.toggleClass(b.CssClasses.MandatoryMark,d.isAsessmentMissingForCompleted())});this.$completedToggle.on(b.ToggleStateChangedEventName,function(a,
c){var d=window[c.toggleInstanceId];h.html(d.isChecked()?b.Terms.CompletedToggleOn:b.Terms.CompletedToggleOff);l.toggleClass(b.CssClasses.MandatoryMark,d.isChecked())});this.$loAssessmentState.change(function(){var a=d.$loAssessmentState.val()===d.rubricToggleChangeValue;d.$rubricCriterias.toggleClass(b.CssClasses.Hidden,!a)})}a.prototype.validateAssessmentForCompleted=function(a,b){this.isAsessmentMissingForCompleted()?b.IsValid=!1:b.IsValid=!0};a.prototype.isAsessmentMissingForCompleted=function(){return(this.$completedToggle.is(":checked")||
this.$simplifiedAssessmentStatusList.val()===this.settings.CompletedStatusValue)&&("0"===this.$assessment.val()||""===this.$scoreText.val())};return a}();d.AssessmentControl=b})(d.Controls||(d.Controls={}))})(Assignment||(Assignment={}));
(function(d){var e=function(){function b(a){var c=this;this.hiddenId=a.data.hiddenId;this.linkId=a.data.linkId;this.containerId=a.data.containerId;this.editorClientInstanceId=a.controls.editorClientInstanceId;if(window.opener)CKEDITOR.on("instanceReady",function(){var c=$(window.opener.document.getElementById(a.data.hiddenId));SetHtml(c.val(),a.controls.editorClientInstanceId);SetTextEditorFocus(a.controls.editorClientInstanceId);c.change(function(){$(this).parents("form").addClass(a.data.cssClasses.dirty)})});
$(a.controls.okButtonSelector).on("click",function(){return c.save()});$(a.controls.cancelButtonSelector).on("click",function(){return window.close()})}b.prototype.save=function(){if(window.opener){var a=GetTextEditorContent(this.editorClientInstanceId),c=$(window.opener.document.getElementById(this.containerId)),b=$(window.opener.document.getElementById(this.linkId)),d=$(window.opener.document.getElementById(this.hiddenId));d.val()!==a&&(c.html(a),d.val(a).trigger("change"));window.opener.TextEditorManager.refreshCustomOpenPopupButtonPosition(d,
b)}window.close()};return b}();d.Editor=e})(Assignment||(Assignment={}));var UploadStatus;(function(d){d[d.Awaiting=0]="Awaiting";d[d.InProgress=1]="InProgress";d[d.Succeeded=2]="Succeeded";d[d.SucceededWithErrors=3]="SucceededWithErrors";d[d.Failed=4]="Failed"})(UploadStatus||(UploadStatus={}));
(function(d){var e=function(){function b(a){this.settings=a}b.prototype.enablePostButtons=function(){$(this.settings.PostButtonsSelectors).each(function(a,c){$(c).removeProp("disabled")})};b.prototype.disablePostButtons=function(){$(this.settings.PostButtonsSelectors).each(function(a,c){$(c).prop("disabled",!0)})};b.prototype.onStatusChanged=function(a){switch(UploadStatus[a]){case "InProgress":this.disablePostButtons();break;case "Succeeded":case "SucceededWithErrors":case "Failed":this.enablePostButtons();
break;default:this.enablePostButtons()}};return b}();d.FileUploaderEventHandler=e})(Assignment||(Assignment={}));
(function(d){(function(d){var b=function(){function a(a,b,d,e){var h=this;void 0===e&&(e=null);this.nextStep=null;this.start=function(){h.controller.start()};this.startNextStep=function(){h.nextStep?h.nextStep.start():h.controller.next()};this.onboardingNotComplete=function(){var a=window[h.onboardingDialogId];a.isMobileView()||CCL.CommonFunctions.isMobileDevice()||($(window).on("resize",h.resizeHandler),a.blockHighlightZone=!0,a.openDialog(h.onboardingCloseHandler),h.overlay(!0))};this.onboardingComplete=
function(){h.startNextStep()};this.onboardingCloseHandler=function(a){$(window).off("resize",h.resizeHandler);a?h.controller.complete(h.featuresForComplete):h.startNextStep();h.controller.complete();h.overlay(!1)};this.resizeHandler=function(){var a=window[h.onboardingDialogId];a.isOpen&&a.isMobileView()&&(h.overlay(!1),$(window).off("resize",h.resizeHandler))};this.cssClasses=a;this.onboardingDialogId=b;this.featureId=d;this.controller=new CCL.Onboarding.Extensions.OnboardingPostMessageController(this.featureId,
e,this.onboardingComplete,this.onboardingNotComplete)}a.prototype.overlay=function(a){this.controller.overlay(a);$(document.body).toggleClass(this.cssClasses.Overlay,a)};return a}();d.Step=b})(d.Onboarding||(d.Onboarding={}))})(Assignment||(Assignment={}));
(function(d){(function(d){var b=CCL.Onboarding.Extensions.OnboardingFeatures,a=function(){function a(){}a.prototype.init=function(a,c){var k=new d.Step(c,a.getStartedDialogClientId,b.AssignmentGetStarted);k.featuresForComplete=[b.AssignmentEdit,b.AssignmentLearningToolOptions,b.AssignmentReminders];var h=new d.Step(c,a.editAssignmentDialogClientId,b.AssignmentEdit,b.AssignmentLearningToolOptions);h.featuresForComplete=[b.AssignmentLearningToolOptions,b.AssignmentReminders];CCL.IframeContentHeightReporter.addSelectorToListenHeight("."+
a.Dialog);k.nextStep=h;k.start()};return a}();d.Tour=a})(d.Onboarding||(d.Onboarding={}))})(Assignment||(Assignment={}));
(function(d){var e=function(b){function a(a){var e=this;b.call(this);this.settings=a;a.controls.onboarding.isOnboardingEnabled&&(new d.Onboarding.Tour).init(a.controls.onboarding,a.data.onboardingCssClasses);this.currentZipTaskInfo=a.data.currentZipTaskInfo;this.gridEmptyTableCell=a.data.cssClasses.gridEmptyTableCell;this.$feedback=$("#"+a.controls.feedbackId);this.$feedbackText=$("#"+a.controls.feedbackTextId);this.$feedbackClose=$("#"+a.controls.feedbackCloseId);this.$errorFeedback=$("#"+a.controls.errorFeedbackId);
this.$errorFeedbackText=$("#"+a.controls.errorFeedbackTextId);this.$itemDownloadAnswersLink=$("#"+this.settings.controls.itemDownloadAnswersLink);this.$modelAnswersCount=a.data.modelAnswersCount;this.$modelAnswersCountId=$("#"+a.controls.modelAnswersCountId);this.$modelAnswersListId=$("#"+a.controls.modelAnswersListId);this.$examplesCountText=a.terms.examplesCountText;this.$emptyModelAnswersListId=$("#"+a.controls.emptyModelAnswersListId);$("#"+this.settings.controls.deleteSelectedAnswersLink).click(function(a){return e.checkBeforeDeleteAnswers(a)});
$("#"+this.settings.controls.downloadAnswersLink).click(function(a){return e.checkBeforeDownload(a)});$("#"+this.settings.controls.deleteAnswerButton).click(this.checkBeforeDeleteAnswer.bind(this));$("#"+this.settings.controls.assessMultipleLink).click(this.checkBeforeAssess.bind(this));this.$feedbackClose.click(this.deleteExistingZiptaskAnswers.bind(this));$("#"+a.controls.gridTableId+" "+a.controls.gridClickableRowSelector).on("clickableRowClicked",this.onGridClickableClick);if(null!==this.settings.controls.commentModule){var f=
$("#"+this.settings.controls.commentModule).getCommentModuleObject();f&&f.loadAndShow()}this.settings.data.reloadTaskbar&&CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged));this.updateUi();this.currentZipTaskInfo.isValid&&this.startPolling();CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.studentWasAssessed,function(){window.location=window.location});
CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.showSettings));$(document).on(a.data.kpi.calculateEvent,$.proxy(function(){CCL.CommonFunctions.measureKpi(a.urls.measureKpi,a.data.kpi.measureSection,a.data.kpi.measurement)},this))}__extends(a,b);a.prototype.onGridClickableClick=function(a){if(a=$(a.currentTarget).parents("tr").find("a.h-hidden").attr("href"))window.location.href=a};a.prototype.updateUi=function(){if(!1===
this.currentZipTaskInfo.isValid)this.$feedbackText.html(""),this.stopPolling(),this.$feedbackClose.show();else switch(this.currentZipTaskInfo.status){case this.settings.data.status.NotStarted:case this.settings.data.status.Waiting:case this.settings.data.status.InProgress:case this.settings.data.status.InProgressExternal:this.$feedbackText.html(this.settings.data.downloadingMessageTemplate);break;case this.settings.data.status.Ok:var a=this.settings.terms.readyMessageTemplate,a=a.replace(this.settings.data.fileRepoToken,
encodeURIComponent(this.currentZipTaskInfo.result));this.$feedbackText.html(a);this.stopPolling();this.$feedbackClose.show();this.$feedback.show();this.$itemDownloadAnswersLink.show();break;case this.settings.data.status.Error:this.stopPolling(),this.$feedback.hide(),this.$itemDownloadAnswersLink.show(),this.$errorFeedbackText.html(this.currentZipTaskInfo.result),this.$errorFeedback.show()}};a.prototype.checkAsyncTaskStatusAndUpdateUi=function(){var a=this;$.ajax({type:"GET",url:this.settings.urls.serviceUrl,
dataType:"json",data:{assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId}}).done(function(b){a.currentZipTaskInfo.status!==b.Status&&(a.currentZipTaskInfo.status=b.Status,a.currentZipTaskInfo.result=b.Result,a.updateUi())}).fail(function(){a.stopPolling();a.$feedback.hide();a.$errorFeedbackText.html(a.settings.terms.errorOccured);a.$errorFeedback.show()})};a.prototype.checkStatus=function(){this.currentZipTaskInfo.isValid&&this.checkAsyncTaskStatusAndUpdateUi()};
a.prototype.startPolling=function(){this.pollingIntervalId=setInterval(this.checkStatus.bind(this),this.settings.data.pollingInterval)};a.prototype.stopPolling=function(){clearInterval(this.pollingIntervalId)};a.prototype.deleteExistingZiptaskAnswers=function(){$.ajax({url:this.settings.urls.deleteExistingZipAnswerstask,type:"POST",dataType:"json",data:{assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId}})};a.prototype.deleteModelAnswer=function(a,
b){var d=this;confirm(this.settings.terms.deleteModelAnswerQuestion)&&$.ajax({url:this.settings.urls.deleteModelAnswer,type:"POST",dataType:"json",data:{assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId,assignmentModelAnswerId:a}}).done(function(){--d.$modelAnswersCount;0<d.$modelAnswersCount?($("#"+b).closest("li").hide(),d.$modelAnswersCountId.text(d.$examplesCountText.replace("{0}",d.$modelAnswersCount.toString()))):(d.$modelAnswersListId.hide(),
d.$emptyModelAnswersListId.show())})};a.prototype.checkBeforeDeleteAnswer=function(){confirm(this.settings.terms.deleteAnswerQuestion)&&$.ajax({url:this.settings.urls.deleteAnswerUrl,type:"POST",data:{assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId},success:function(){CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged));window.location.href=
window.location.href},error:function(){alert(this.settings.terms.errorOccured)}});return!1};a.prototype.checkBeforeDeleteAnswers=function(a){return 0===window[this.settings.controls.gridId].getSelectedValues().length?(alert(this.settings.terms.selectMessage),!1):confirm(this.settings.terms.deleteAnswersQuestion)};a.prototype.checkBeforeAssess=function(){return 0===window[this.settings.controls.gridId].getSelectedValues().length?(alert(this.settings.terms.selectMessage),!1):!0};a.prototype.checkBeforeDownload=
function(a){var b=this;return this.checkBeforeActionOnAnswers(a,function(a){a?(new Function(b.settings.controls.downloadAnswersPostbackRef))():alert(b.settings.terms.nothingToDownload)})};a.prototype.checkBeforeActionOnAnswers=function(a,b){var d=window[this.settings.controls.gridId].getSelectedValues(),e=$(a.currentTarget);if(e.hasClass("disabled"))return!1;if(0===d.length)return alert(this.settings.terms.selectMessage),!1;e.addClass("disabled");this.checkIfAnyAnswersExist(d,e,function(a){b(a);e.removeClass("disabled");
e.parent("li").trigger("click")});return!1};a.prototype.checkIfAnyAnswersExist=function(a,b,d){var e=this;$.ajax({url:this.settings.urls.isAnyAnswerSubmittedByUsers,contentType:"application/json",dataType:"json",type:"POST",data:JSON.stringify({assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId,userIds:a})}).done(function(a){d(a.d)}).fail(function(){b.removeClass("disabled");alert(e.settings.terms.errorOccured)})};return a}(d.Base);d.Read=e})(Assignment||
(Assignment={}));
(function(d){var e=function(b){function a(a){b.call(this,new d.BaseEditSettings(a.data.navigateAwayMessage));this.settings=a;this.$feedback=$(this.settings.controls.feedback);this.$buttonSave=$(this.settings.controls.buttonSave);this.$title=$(this.settings.controls.title);new CCL.ButtonLoadingIndicator(this.settings.controls.buttonSave,this.settings.data.inProgressClass);this.$buttonSave.click(this.onSaveClick.bind(this))}__extends(a,b);a.prototype.onSaveClick=function(a){a=this.$title.val().trim();var b=
GetTextEditorContent(this.settings.controls.editorClientInstanceId),d=FileRepoUploaderInstance.ReadFileList();if(0===a.length)this.$feedback.html(this.settings.data.enterTitle).show(),this.errorEventHandler();else if(0===b.length&&0===d.length)this.$feedback.html(this.settings.data.enterTextOrFiles).show(),this.errorEventHandler();else return!0;return!1};a.prototype.errorEventHandler=function(){this.$buttonSave.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator);this.scrollPageToTop()};
return a}(d.BaseEdit);d.AddEditModelAnswer=e})(Assignment||(Assignment={}));
(function(d){var e=function(b){function a(a){var e=this;b.call(this,new d.BaseEditSettings(a.data.terms.navigateAwayMessage));this.settings=a;CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.hideSettings));new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.cssClasses.inProgressClass);$(this.settings.controls.okButtonSelector).click(function(){if(!IsEditorEmpty(a.controls.textEditorId)&&e.settings.data.hasAnyComment&&
!confirm(e.settings.data.terms.feedbackWarningMessage))return e.removeLoadingIndicator(),!1;e.okHandler()});$("form").submit(function(){$(e.settings.controls.okButtonSelector).addClass(e.settings.data.cssClasses.buttonDisabled).prop("disabled",!1);return!0})}__extends(a,b);a.prototype.okHandler=function(){!1===window.Page_IsValid&&this.removeLoadingIndicator()};a.prototype.removeLoadingIndicator=function(){$(this.settings.controls.okButtonSelector).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)};
return a}(d.BaseEdit);d.AssessMultiple=e})(Assignment||(Assignment={}));
(function(d){var e=function(){return function(){}}();d.SectionExpanderSettings=e;e=function(){return function(b){var a=b.expander.children("span.as-expander-text");b.expander.click(function(){b.target.toggleClass(b.cssClasses.sectionExpanderHide);var c=!b.target.hasClass(b.cssClasses.sectionExpanderHide);a.text(c?b.terms.hide:b.terms.show);b.expander.toggleClass("expanded",c);b.expander.hasClass("as-section-expander-with-arrow")&&b.expander.closest("."+b.cssClasses.box).toggleClass(b.cssClasses.noPrint,
!c)})}}();d.SectionExpander=e})(Assignment||(Assignment={}));
(function(d){var e=function(){function b(a){this.settings=a;this.isFirstFunctionCall=!0;var b=this;if("undefined"!==typeof CKEDITOR)CKEDITOR.on("instanceReady",function(a){a=CKEDITOR.instances[b.settings.EditorClientInstanceId];if(b.isFirstFunctionCall&&"ready"===a.status){if(b.settings.IsToolbarExpanded){var d=a.getCommand(b.settings.ToolbarExpandedCommandName),e=d.editorFocus;d.editorFocus=!1;a.execCommand(b.settings.ToolbarExpandedCommandName);d.editorFocus=e}a.on(b.settings.ToolbarExpandedEvent,
function(a){b.toggleToolbar(a.data.expanded)});b.isFirstFunctionCall=!1}})}b.prototype.toggleToolbar=function(a){$.ajax({type:"POST",dataType:"json",url:this.settings.SetUserPreferenceWebMethods,data:{category:this.settings.PageName,name:this.settings.EditorKeyForPreferences,value:a}})};return b}();d.TextEditorWrapper=e})(Assignment||(Assignment={}));
(function(d){var e=function(){return function(b){CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.extensionPrintContentFrame,function(a){null!=a&&(document.title=a.headerText,$(b.controls.clientID).html(a.headerHtml));$("."+b.data.cssClasses.criteriaDescriptionRow).removeClass(b.data.cssClasses.NoPrint);$("."+b.data.cssClasses.criteriaDescriptionRow+":has("+b.data.cssClasses.emptyState+")").addClass(b.data.cssClasses.noPrint);if("undefined"!==typeof CKEDITOR&&
null!=CKEDITOR.instances)for(var c in CKEDITOR.instances)a=CKEDITOR.instances[c],$(a.container.$).find(".cke_top").addClass(b.data.cssClasses.noPrint),$(a.container.$).find(".cke_bottom").addClass(b.data.cssClasses.noPrint),""===a.getData()?$("."+b.data.cssClasses.feedbackTextEditorPanel).addClass(b.data.cssClasses.noPrint):$("."+b.data.cssClasses.feedbackTextEditorPanel).removeClass(b.data.cssClasses.noPrint);CCL.CommonFunctions.isFirefox()&&(window.onbeforeprint=function(){$("."+b.data.cssClasses.fieldsetPrinting+
" fieldset").each(function(){$(this).replaceWith($('<div class="fieldset">'+this.innerHTML+"</div>"))})},window.onafterprint=function(){$("."+b.data.cssClasses.fieldsetPrinting+" .fieldset").each(function(){$(this).replaceWith($("<fieldset>"+this.innerHTML+"</fieldset>"))})});window.focus();window.print();$(document).trigger(b.data.calculateMeasureKpiEvent)})}}();d.Master=e})(Assignment||(Assignment={}));function CommentModuleManagerWrapper(d){function e(b,d,e){return function(d){e(b,d);$(b).trigger(a)}}window[d]=this;var b,a;this.initialize=function(c){b=c;a=b.commentModuleChangeEvent};this.addComment=function(a,d,f,k,h,l,m){$.ajax({type:"POST",datatype:"json",url:b.urls.addComment,data:{learningObjectId:d.LearningObjectId,learningObjectInstanceId:d.LearningObjectInstanceId,assignmentInstanceAnswerId:d.AssignmentInstanceAnswerId,commentType:d.CommentType,text:f,lastVisibleCommentId:k}}).done(e(a,
d,l)).fail(function(){m(a)})};this.editComment=function(a,d,f,k,h,l,m){$.ajax({type:"POST",datatype:"json",url:b.urls.editComment,data:{learningObjectId:d.LearningObjectId,learningObjectInstanceId:d.LearningObjectInstanceId,assignmentInstanceAnswerId:d.AssignmentInstanceAnswerId,commentId:f,text:k}}).done(e(a,d,l)).fail(function(b){m(a,f,b)})};this.deleteComment=function(a,d,f,k,h){$.ajax({type:"POST",datatype:"json",url:b.urls.deleteComment,data:{learningObjectId:d.LearningObjectId,learningObjectInstanceId:d.LearningObjectInstanceId,
assignmentInstanceAnswerId:d.AssignmentInstanceAnswerId,commentId:f}}).done(e(a,d,k)).fail(function(b){h(a,f,b)})};this.loadOld=function(c,d,e,k,h,l,m,q){$.ajax({type:"GET",datatype:"json",url:b.urls.getOld,data:{learningObjectId:d.LearningObjectId,learningObjectInstanceId:d.LearningObjectInstanceId,assignmentInstanceAnswerId:d.AssignmentInstanceAnswerId,commentType:d.CommentType,commentId:e,count:k,numberOfPreviouslyReadItemsToDisplay:h}}).done(function(d){b.showCommentModuleIfNoCommentsExist||0<
d.Items.length?m(c,d):c.hide();$(c).trigger(a)}).fail(function(a){q(c,a)})};return this};
